---
- name: Install VirtualBox Guest Additions
  hosts: all
  become: yes
 
  tasks:
    - name: Update package repository
      apt:
        update_cache: yes
 
    - name: Install required packages
      apt:
        name:
          - build-essential
          - dkms
          - linux-headers-amd64
 
    - name: Mount Guest Additions ISO
      mount:
        path: /mnt/cdrom
        src: /usr/share/virtualbox/VBoxGuestAdditions.iso
        fstype: iso9660
        state: mounted
 
    - name: Install Guest Additions
      shell: /mnt/cdrom/VBoxLinuxAdditions.run
 
    - name: Unmount Guest Additions ISO
      mount:
        path: /mnt/cdrom
        state: unmounted